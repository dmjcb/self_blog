---
title: "交叉编译器构建"
date: 2025-01-05
categories: [c++]
tags: [c++]
excerpt: "交叉编译器构建"
---

## 交叉编译器构建

### 安装依赖

```sh
sudo apt update
sudo apt install build-essential flex bison gawk texinfo gmp libmpfr-dev libmpc-dev libisl-dev
```

### 下载源码

下载 GCC、Binutils 和 Glibc 的源码

GCCGNU 编译器集合, 提供g++ 编译器

Binutils提供链接器和汇编器

Glibc提供 C 标准库

```sh
# 下载 GCC 源码
wget https://ftp.gnu.org/gnu/gcc/gcc-12.2.0/gcc-12.2.0.tar.gz
tar -xvzf gcc-12.2.0.tar.gz
cd gcc-12.2.0

# 下载 Binutils 源码
wget https://ftp.gnu.org/gnu/binutils/binutils-2.39.tar.gz
tar -xvzf binutils-2.39.tar.gz

# 下载 Glibc 源码
wget http://ftp.gnu.org/gnu/libc/glibc-2.36.tar.gz
tar -xvzf glibc-2.36.tar.gz
```

### 配置交叉编译环境

创建交叉编译目录

为了防止与宿主系统的工具链冲突, 最好为交叉编译器创建一个独立目录结构

```sh
mkdir -p ~/cross_compile/aarch64-linux-gnu
cd ~/cross_compile/aarch64-linux-gnu
```

#### 配置 Binutils

首先, 配置 Binutils(汇编器、链接器等), 需要指定目标架构为 aarch64

```sh
cd ~/cross_compile/aarch64-linux-gnu
mkdir build-binutils
cd build-binutils
~/cross_compile/binutils-2.39/configure --prefix=/home/your_user/cross_compile/aarch64-linux-gnu --target=aarch64-linux-gnu --with-sysroot --disable-nls --disable-werror
make
make install
```

#### 配置 GCC

在配置 GCC 时, 需要指定交叉编译目标, 并且使用之前构建的 Binutils 作为工具链

```sh
cd ~/cross_compile/aarch64-linux-gnu
mkdir build-gcc
cd build-gcc
~/cross_compile/gcc-12.2.0/configure --prefix=/home/your_user/cross_compile/aarch64-linux-gnu --target=aarch64-linux-gnu --enable-languages=c,c++ --disable-nls --without-headers --with-sysroot=/home/your_user/cross_compile/aarch64-linux-gnu --disable-multilib --disable-shared
make all-gcc
make all-target-libgcc
make install-gcc
make install-target-libgcc
```

#### 配置 Glibc

构建 Glibc 时, 也需要指定目标平台和工具链

```sh
cd ~/cross_compile/aarch64-linux-gnu
mkdir build-glibc
cd build-glibc
~/cross_compile/glibc-2.36/configure --prefix=/home/your_user/cross_compile/aarch64-linux-gnu --host=aarch64-linux-gnu --target=aarch64-linux-gnu --disable-multilib
make
make install
```

### 构建交叉编译器

构建 g++ 编译器
使用上面配置的工具链和库, 继续构建 C++ 编译器

```sh
cd ~/cross_compile/aarch64-linux-gnu
mkdir build-g++-final
cd build-g++-final
make
make install
```

### 验证交叉编译器

安装完成后, 可以通过以下命令验证交叉编译器是否安装成功

```sh
~/cross_compile/aarch64-linux-gnu/bin/aarch64-linux-gnu-g++ --version
```
如果看到类似如下的输出, 则说明交叉编译器构建成功

```sh
aarch64-linux-gnu-g++ (GCC) 12.2.0
```

### 使用交叉编译器

现在, 可以使用 aarch64-linux-gnu-g++ 来交叉编译目标架构为 aarch64 的 C++ 程序

```sh
aarch64-linux-gnu-g++ -o hello hello.cpp
```